<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Validating GTFS feeds • gtfstools</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validating GTFS feeds">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gtfstools</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/gtfstools.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/filtering.html">Filtering GTFS feeds</a></li>
    <li><a class="dropdown-item" href="../articles/validating.html">Validating GTFS feeds</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ipeaGIT/gtfstools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Validating GTFS feeds</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/gtfstools/blob/main/vignettes/validating.Rmd" class="external-link"><code>vignettes/validating.Rmd</code></a></small>
      <div class="d-none name"><code>validating.Rmd</code></div>
    </div>

    
    
<p>Transport planners and researchers very frequently want to assess the
quality of the GTFS feeds they have produced and consumed. Are the feeds
structured according to the <a href="https://github.com/MobilityData/GTFS_Schedule_Best-Practices" class="external-link">best
practices</a> agreed by members of the larger GTFS community? Are tables
and fields adequately formatted? Is the information described in the
feed reasonable (vehicle speeds, stop locations, etc.)? These are some
of the questions that may arise when dealing with GTFS data.</p>
<p>In order to answer these puzzling questions,
<strong>gtfstools</strong> includes <code><a href="../reference/validate_gtfs.html">validate_gtfs()</a></code>, a
function that wraps the <a href="https://github.com/MobilityData/gtfs-validator" class="external-link">Canonical GTFS
Validator</a> developed by MobilityData. The validator requires Java 11
or higher to run - you can check the version you have currently
installed with the command <code>java -version</code> on a terminal
session or with the command <code>system("java -version")</code> from
your R session. If need be, you can download Java 11 from <a href="https://www.oracle.com/java/technologies/downloads" class="external-link uri">https://www.oracle.com/java/technologies/downloads</a>.</p>
<p>Using <code><a href="../reference/validate_gtfs.html">validate_gtfs()</a></code> is very simple and requires no
more than a few function calls. First we need to download the validator
command-line tool. We can do it manually from MobilityData releases, or
we can use <code><a href="../reference/download_validator.html">download_validator()</a></code>. This function takes a path
to a directory where the validator should be saved to and a validator
version, which defaults to the latest release, and returns the path to
the downloaded validator. Please note that manually downloaded
validators should be saved with the same filename convention used by the
function (i.e. <code>gtfs-validator-vX.Y.Z.jar</code>). This is
important to make sure that our validation function can correctly parse
the command-line tool version, which controls some of its behavior.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ipeagit.github.io/gtfstools/">gtfstools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">latest_validator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_validator.html">download_validator</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">latest_validator</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmpyV9ENr/gtfs-validator-v6.0.0.jar"</span></span></code></pre></div>
<p>The second (and final) step is actually running
<code><a href="../reference/validate_gtfs.html">validate_gtfs()</a></code>. To do that we need some GTFS data, which
the function accepts in varying formats: it can be a GTFS object, as
created with <code><a href="../reference/read_gtfs.html">read_gtfs()</a></code>, a path to local GTFS file, an URL
to a feed or a path to a local directory containing the GTFS data. It
also takes a path to the directory where the validator output should be
saved to and the path to the validator, previously generated with
<code><a href="../reference/download_validator.html">download_validator()</a></code>. Let’s see how it works, using the
same GTFS data in three different formats:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/spo_gtfs.zip"</span>, package <span class="op">=</span> <span class="st">"gtfstools"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">path_output_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"validation_from_path"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/validate_gtfs.html">validate_gtfs</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="va">path_output_dir</span>, <span class="va">latest_validator</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">path_output_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "report.html"           "report.json"           "system_errors.json"   </span></span>
<span><span class="co">#&gt; [4] "validation_stderr.txt"</span></span></code></pre></div>
<p>As we can see, the validation generates a few output files:</p>
<ul>
<li>
<code>report.html</code>, shown below, summarizes the validation
results in a nicely formatted HTML page (only available when using
validator v3.1.0 or higher);</li>
<li>
<code>report.json</code> summarizes the exact same information, but
in JSON format, which can be used to easily parse and process the
results;</li>
<li>
<code>system_errors.json</code> summarizes eventual system erros
that may have happened during the validation and may compromise the
results;</li>
<li>
<code>validation_stderr.txt</code> lists the informative messages
sent by the command-line tool to the standard error output stream, which
includes the list of validators in use, eventual error messages,
etc;</li>
<li>had the command-line tool printed anything to the standard output
stream, the content would have been saved in
<code>validation_stdout.txt</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Please note that the content of
&lt;code&gt;validation_stdout.txt&lt;/code&gt; and
&lt;code&gt;validation_stderr.txt&lt;/code&gt; may slightly vary depending on the
version of the validator.&lt;/p&gt;"><sup>1</sup></a>.</li>
</ul>
<p><img src="../reference/figures/html_validation_report.png" width="100%"></p>
<p>Had we run the validator using the same GTFS data in different
formats (an URL or a GTFS object, for example) the results would be
exactly the same:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gtfs_url</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/ipeaGIT/gtfstools/raw/main/inst/extdata/spo_gtfs.zip"</span></span>
<span><span class="va">gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_gtfs.html">read_gtfs</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span></span>
<span></span>
<span><span class="va">url_output_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"validation_from_url"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/validate_gtfs.html">validate_gtfs</a></span><span class="op">(</span><span class="va">gtfs_url</span>, <span class="va">url_output_dir</span>, <span class="va">latest_validator</span><span class="op">)</span></span>
<span></span>
<span><span class="va">object_output_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"validation_from_object"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/validate_gtfs.html">validate_gtfs</a></span><span class="op">(</span><span class="va">gtfs</span>, <span class="va">object_output_dir</span>, <span class="va">latest_validator</span><span class="op">)</span></span>
<span></span>
<span><span class="va">validation_content</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">report_json_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"report.json"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">report_json_content</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">report_json_path</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">report_json_content</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">path_output_content</span> <span class="op">&lt;-</span> <span class="fu">validation_content</span><span class="op">(</span><span class="va">path_output_dir</span><span class="op">)</span></span>
<span><span class="va">url_output_content</span> <span class="op">&lt;-</span> <span class="fu">validation_content</span><span class="op">(</span><span class="va">url_output_dir</span><span class="op">)</span></span>
<span><span class="va">object_output_content</span> <span class="op">&lt;-</span> <span class="fu">validation_content</span><span class="op">(</span><span class="va">object_output_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">path_output_content</span>, <span class="va">url_output_content</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">path_output_content</span>, <span class="va">object_output_content</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Once again, it’s important to acknowledge that
<code><a href="../reference/validate_gtfs.html">validate_gtfs()</a></code> only exists thanks to the hard-work of
folks at <a href="https://github.com/MobilityData/gtfs-validator" class="external-link">MobilityData/gtfs-validator</a>.
A huge shoutout to them!</p>

  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Herszenhut, Rafael H. M. Pereira, Pedro R. Andrade, Joao Bazzo, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
