<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Set trip average speed — set_trip_speed • gtfstools</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Set trip average speed — set_trip_speed"><meta name="description" content="Sets the average speed of each specified trip_id by changing the
arrival_time and departure_time columns in stop_times."><meta property="og:description" content="Sets the average speed of each specified trip_id by changing the
arrival_time and departure_time columns in stop_times."><meta property="og:image" content="https://ipeagit.github.io/gtfstools/logo.png"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gtfstools</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/gtfstools.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/filtering.html">Filtering GTFS feeds</a></li>
    <li><a class="dropdown-item" href="../articles/validating.html">Validating GTFS feeds</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ipeaGIT/gtfstools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Set trip average speed</h1>
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/gtfstools/blob/main/R/set_trip_speed.R" class="external-link"><code>R/set_trip_speed.R</code></a></small>
      <div class="d-none name"><code>set_trip_speed.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Sets the average speed of each specified <code>trip_id</code> by changing the
<code>arrival_time</code> and <code>departure_time</code> columns in <code>stop_times</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">set_trip_speed</span><span class="op">(</span><span class="va">gtfs</span>, <span class="va">trip_id</span>, <span class="va">speed</span>, unit <span class="op">=</span> <span class="st">"km/h"</span>, by_reference <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-gtfs">gtfs<a class="anchor" aria-label="anchor" href="#arg-gtfs"></a></dt>
<dd><p>A GTFS object, as created by <code><a href="read_gtfs.html">read_gtfs()</a></code>.</p></dd>


<dt id="arg-trip-id">trip_id<a class="anchor" aria-label="anchor" href="#arg-trip-id"></a></dt>
<dd><p>A string vector including the <code>trip_id</code>s to have their
average speed set.</p></dd>


<dt id="arg-speed">speed<a class="anchor" aria-label="anchor" href="#arg-speed"></a></dt>
<dd><p>A numeric representing the speed to be set. Its length must
either equal 1, in which case the value is recycled for all
<code>trip_id</code>s, or equal <code>trip_id</code>'s length.</p></dd>


<dt id="arg-unit">unit<a class="anchor" aria-label="anchor" href="#arg-unit"></a></dt>
<dd><p>A string representing the unit in which the speed is given. One
of <code>"km/h"</code> (the default) or <code>"m/s"</code>.</p></dd>


<dt id="arg-by-reference">by_reference<a class="anchor" aria-label="anchor" href="#arg-by-reference"></a></dt>
<dd><p>Whether to update <code>stop_times</code>' <code>data.table</code> by
reference. Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>by_reference</code> is set to <code>FALSE</code>, returns a GTFS object with the
time columns of its <code>stop_times</code> adjusted. Else, returns a GTFS object
invisibly (note that in this case the original GTFS object is altered).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>


<p>The average speed is calculated as the difference between the arrival time
at the last stop minus the departure time at the first top, over the trip's
length (as calculated via <code><a href="get_trip_geometry.html">get_trip_geometry()</a></code>, based on the <code>shapes</code>
file). The arrival and departure times at all other stops (i.e. not the
first neither the last) are set as <code>""</code>, which is written as <code>NA</code> with
<code><a href="write_gtfs.html">write_gtfs()</a></code>. Some transport routing software, such as
<a href="http://www.opentripplanner.org/" class="external-link">OpenTripPlanner</a>, support specifying stop
times like so. In such cases, they estimate arrival/departure times at the
others stops based on the average speed as well. We plan to add that feature
to this function in the future.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/spo_gtfs.zip"</span>, package <span class="op">=</span> <span class="st">"gtfstools"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_gtfs.html">read_gtfs</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gtfs_new_speed</span> <span class="op">&lt;-</span> <span class="fu">set_trip_speed</span><span class="op">(</span><span class="va">gtfs</span>, trip_id <span class="op">=</span> <span class="st">"CPTM L07-0"</span>, <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gtfs_new_speed</span><span class="op">$</span><span class="va">stop_times</span><span class="op">[</span><span class="va">trip_id</span> <span class="op">==</span> <span class="st">"CPTM L07-0"</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        trip_id arrival_time departure_time stop_id stop_sequence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;char&gt;       &lt;char&gt;         &lt;char&gt;  &lt;char&gt;         &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: CPTM L07-0     04:00:00       04:00:00   18940             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: CPTM L07-0                               18920             2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: CPTM L07-0                               18919             3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: CPTM L07-0                               18917             4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: CPTM L07-0                               18916             5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: CPTM L07-0                               18965             6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: CPTM L07-0                               18923             7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: CPTM L07-0                               18922             8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: CPTM L07-0                             4114459             9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: CPTM L07-0                               18921            10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: CPTM L07-0                               18924            11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: CPTM L07-0                               18925            12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: CPTM L07-0                               18926            13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: CPTM L07-0                               18971            14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: CPTM L07-0                               18972            15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: CPTM L07-0                               18973            16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: CPTM L07-0                               18974            17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: CPTM L07-0     05:12:51       05:12:51   18975            18</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use the unit argument to change the speed unit</span></span></span>
<span class="r-in"><span><span class="va">gtfs_new_speed</span> <span class="op">&lt;-</span> <span class="fu">set_trip_speed</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">gtfs</span>,</span></span>
<span class="r-in"><span>  trip_id <span class="op">=</span> <span class="st">"CPTM L07-0"</span>,</span></span>
<span class="r-in"><span>  speed <span class="op">=</span> <span class="fl">15</span>,</span></span>
<span class="r-in"><span>  unit <span class="op">=</span> <span class="st">"m/s"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gtfs_new_speed</span><span class="op">$</span><span class="va">stop_times</span><span class="op">[</span><span class="va">trip_id</span> <span class="op">==</span> <span class="st">"CPTM L07-0"</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        trip_id arrival_time departure_time stop_id stop_sequence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;char&gt;       &lt;char&gt;         &lt;char&gt;  &lt;char&gt;         &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: CPTM L07-0     04:00:00       04:00:00   18940             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: CPTM L07-0                               18920             2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: CPTM L07-0                               18919             3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: CPTM L07-0                               18917             4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: CPTM L07-0                               18916             5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: CPTM L07-0                               18965             6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: CPTM L07-0                               18923             7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: CPTM L07-0                               18922             8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: CPTM L07-0                             4114459             9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: CPTM L07-0                               18921            10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: CPTM L07-0                               18924            11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: CPTM L07-0                               18925            12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: CPTM L07-0                               18926            13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: CPTM L07-0                               18971            14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: CPTM L07-0                               18972            15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: CPTM L07-0                               18973            16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: CPTM L07-0                               18974            17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: CPTM L07-0     05:07:27       05:07:27   18975            18</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># original gtfs remains unchanged</span></span></span>
<span class="r-in"><span><span class="va">gtfs</span><span class="op">$</span><span class="va">stop_times</span><span class="op">[</span><span class="va">trip_id</span> <span class="op">==</span> <span class="st">"CPTM L07-0"</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        trip_id arrival_time departure_time stop_id stop_sequence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;char&gt;       &lt;char&gt;         &lt;char&gt;  &lt;char&gt;         &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: CPTM L07-0     04:00:00       04:00:00   18940             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: CPTM L07-0     04:08:00       04:08:00   18920             2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: CPTM L07-0     04:16:00       04:16:00   18919             3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: CPTM L07-0     04:24:00       04:24:00   18917             4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: CPTM L07-0     04:32:00       04:32:00   18916             5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: CPTM L07-0     04:40:00       04:40:00   18965             6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: CPTM L07-0     04:48:00       04:48:00   18923             7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: CPTM L07-0     04:56:00       04:56:00   18922             8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: CPTM L07-0     05:04:00       05:04:00 4114459             9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: CPTM L07-0     05:12:00       05:12:00   18921            10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: CPTM L07-0     05:20:00       05:20:00   18924            11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: CPTM L07-0     05:28:00       05:28:00   18925            12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: CPTM L07-0     05:36:00       05:36:00   18926            13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: CPTM L07-0     05:44:00       05:44:00   18971            14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: CPTM L07-0     05:52:00       05:52:00   18972            15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: CPTM L07-0     06:00:00       06:00:00   18973            16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: CPTM L07-0     06:08:00       06:08:00   18974            17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: CPTM L07-0     06:16:00       06:16:00   18975            18</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># when doing by reference, original gtfs is changed</span></span></span>
<span class="r-in"><span><span class="fu">set_trip_speed</span><span class="op">(</span><span class="va">gtfs</span>, trip_id <span class="op">=</span> <span class="st">"CPTM L07-0"</span>, <span class="fl">50</span>, by_reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gtfs</span><span class="op">$</span><span class="va">stop_times</span><span class="op">[</span><span class="va">trip_id</span> <span class="op">==</span> <span class="st">"CPTM L07-0"</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        trip_id arrival_time departure_time stop_id stop_sequence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;char&gt;       &lt;char&gt;         &lt;char&gt;  &lt;char&gt;         &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: CPTM L07-0     04:00:00       04:00:00   18940             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: CPTM L07-0                               18920             2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: CPTM L07-0                               18919             3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: CPTM L07-0                               18917             4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: CPTM L07-0                               18916             5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: CPTM L07-0                               18965             6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: CPTM L07-0                               18923             7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: CPTM L07-0                               18922             8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: CPTM L07-0                             4114459             9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: CPTM L07-0                               18921            10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: CPTM L07-0                               18924            11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: CPTM L07-0                               18925            12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: CPTM L07-0                               18926            13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: CPTM L07-0                               18971            14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: CPTM L07-0                               18972            15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: CPTM L07-0                               18973            16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: CPTM L07-0                               18974            17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: CPTM L07-0     05:12:51       05:12:51   18975            18</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Herszenhut, Rafael H. M. Pereira, Pedro R. Andrade, Joao Bazzo, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

