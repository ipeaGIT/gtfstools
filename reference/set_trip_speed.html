<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Set trip average speed — set_trip_speed • gtfstools</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Set trip average speed — set_trip_speed"><meta property="og:description" content="Sets the average speed of each specified trip_id by changing the
arrival_time and departure_time columns in stop_times."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gtfstools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/gtfstools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/filtering.html">Filtering GTFS feeds</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ipeaGIT/gtfstools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Set trip average speed</h1>
    <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/gtfstools/blob/HEAD/R/set_trip_speed.R" class="external-link"><code>R/set_trip_speed.R</code></a></small>
    <div class="hidden name"><code>set_trip_speed.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Sets the average speed of each specified <code>trip_id</code> by changing the
<code>arrival_time</code> and <code>departure_time</code> columns in <code>stop_times</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">set_trip_speed</span><span class="op">(</span><span class="va">gtfs</span>, <span class="va">trip_id</span>, <span class="va">speed</span>, unit <span class="op">=</span> <span class="st">"km/h"</span>, by_reference <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>gtfs</dt>
<dd><p>A GTFS object, as created by <code><a href="read_gtfs.html">read_gtfs()</a></code>.</p></dd>


<dt>trip_id</dt>
<dd><p>A string vector including the <code>trip_id</code>s to have their
average speed set.</p></dd>


<dt>speed</dt>
<dd><p>A numeric representing the speed to be set. Its length must
either equal 1, in which case the value is recycled for all
<code>trip_id</code>s, or equal <code>trip_id</code>'s length.</p></dd>


<dt>unit</dt>
<dd><p>A string representing the unit in which the speed is given. One
of <code>"km/h"</code> (the default) or <code>"m/s"</code>.</p></dd>


<dt>by_reference</dt>
<dd><p>Whether to update <code>stop_times</code>' <code>data.table</code> by
reference. Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>If <code>by_reference</code> is set to <code>FALSE</code>, returns a GTFS object with the
time columns of its <code>stop_times</code> adjusted. Else, returns a GTFS object
invisibly (note that in this case the original GTFS object is altered).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    

<p>The average speed is calculated as the difference between the arrival time
at the last stop minus the departure time at the first top, over the trip's
length (as calculated via <code><a href="get_trip_geometry.html">get_trip_geometry()</a></code>, based on the <code>shapes</code>
file). The arrival and departure times at all other stops (i.e. not the
first neither the last) are set as <code>""</code>, which is written as <code>NA</code> with
<code><a href="write_gtfs.html">write_gtfs()</a></code>. Some transport routing software, such as
<a href="http://www.opentripplanner.org/" class="external-link">OpenTripPlanner</a>, support specifying stop
times like so. In such cases, they estimate arrival/departure times at the
others stops based on the average speed as well. We plan to add that feature
to this function in the future.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/spo_gtfs.zip"</span>, package <span class="op">=</span> <span class="st">"gtfstools"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_gtfs.html">read_gtfs</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">gtfs_new_speed</span> <span class="op">&lt;-</span> <span class="fu">set_trip_speed</span><span class="op">(</span><span class="va">gtfs</span>, trip_id <span class="op">=</span> <span class="st">"CPTM L07-0"</span>, <span class="fl">50</span><span class="op">)</span></span>
<span class="r-in"><span class="va">gtfs_new_speed</span><span class="op">$</span><span class="va">stop_times</span><span class="op">[</span><span class="va">trip_id</span> <span class="op">==</span> <span class="st">"CPTM L07-0"</span><span class="op">]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        trip_id arrival_time departure_time stop_id stop_sequence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: CPTM L07-0     04:00:00       04:00:00   18940             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: CPTM L07-0                               18920             2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: CPTM L07-0                               18919             3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: CPTM L07-0                               18917             4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: CPTM L07-0                               18916             5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: CPTM L07-0                               18965             6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: CPTM L07-0                               18923             7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: CPTM L07-0                               18922             8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: CPTM L07-0                             4114459             9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: CPTM L07-0                               18921            10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: CPTM L07-0                               18924            11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: CPTM L07-0                               18925            12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: CPTM L07-0                               18926            13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: CPTM L07-0                               18971            14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: CPTM L07-0                               18972            15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: CPTM L07-0                               18973            16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: CPTM L07-0                               18974            17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: CPTM L07-0     05:12:51       05:12:51   18975            18</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># use the unit argument to change the speed unit</span></span>
<span class="r-in"><span class="va">gtfs_new_speed</span> <span class="op">&lt;-</span> <span class="fu">set_trip_speed</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">gtfs</span>,</span>
<span class="r-in">  trip_id <span class="op">=</span> <span class="st">"CPTM L07-0"</span>,</span>
<span class="r-in">  speed <span class="op">=</span> <span class="fl">15</span>,</span>
<span class="r-in">  unit <span class="op">=</span> <span class="st">"m/s"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="va">gtfs_new_speed</span><span class="op">$</span><span class="va">stop_times</span><span class="op">[</span><span class="va">trip_id</span> <span class="op">==</span> <span class="st">"CPTM L07-0"</span><span class="op">]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        trip_id arrival_time departure_time stop_id stop_sequence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: CPTM L07-0     04:00:00       04:00:00   18940             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: CPTM L07-0                               18920             2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: CPTM L07-0                               18919             3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: CPTM L07-0                               18917             4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: CPTM L07-0                               18916             5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: CPTM L07-0                               18965             6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: CPTM L07-0                               18923             7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: CPTM L07-0                               18922             8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: CPTM L07-0                             4114459             9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: CPTM L07-0                               18921            10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: CPTM L07-0                               18924            11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: CPTM L07-0                               18925            12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: CPTM L07-0                               18926            13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: CPTM L07-0                               18971            14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: CPTM L07-0                               18972            15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: CPTM L07-0                               18973            16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: CPTM L07-0                               18974            17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: CPTM L07-0     05:07:27       05:07:27   18975            18</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># original gtfs remains unchanged</span></span>
<span class="r-in"><span class="va">gtfs</span><span class="op">$</span><span class="va">stop_times</span><span class="op">[</span><span class="va">trip_id</span> <span class="op">==</span> <span class="st">"CPTM L07-0"</span><span class="op">]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        trip_id arrival_time departure_time stop_id stop_sequence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: CPTM L07-0     04:00:00       04:00:00   18940             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: CPTM L07-0     04:08:00       04:08:00   18920             2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: CPTM L07-0     04:16:00       04:16:00   18919             3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: CPTM L07-0     04:24:00       04:24:00   18917             4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: CPTM L07-0     04:32:00       04:32:00   18916             5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: CPTM L07-0     04:40:00       04:40:00   18965             6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: CPTM L07-0     04:48:00       04:48:00   18923             7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: CPTM L07-0     04:56:00       04:56:00   18922             8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: CPTM L07-0     05:04:00       05:04:00 4114459             9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: CPTM L07-0     05:12:00       05:12:00   18921            10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: CPTM L07-0     05:20:00       05:20:00   18924            11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: CPTM L07-0     05:28:00       05:28:00   18925            12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: CPTM L07-0     05:36:00       05:36:00   18926            13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: CPTM L07-0     05:44:00       05:44:00   18971            14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: CPTM L07-0     05:52:00       05:52:00   18972            15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: CPTM L07-0     06:00:00       06:00:00   18973            16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: CPTM L07-0     06:08:00       06:08:00   18974            17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: CPTM L07-0     06:16:00       06:16:00   18975            18</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># when doing by reference, original gtfs is changed</span></span>
<span class="r-in"><span class="fu">set_trip_speed</span><span class="op">(</span><span class="va">gtfs</span>, trip_id <span class="op">=</span> <span class="st">"CPTM L07-0"</span>, <span class="fl">50</span>, by_reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="va">gtfs</span><span class="op">$</span><span class="va">stop_times</span><span class="op">[</span><span class="va">trip_id</span> <span class="op">==</span> <span class="st">"CPTM L07-0"</span><span class="op">]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        trip_id arrival_time departure_time stop_id stop_sequence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: CPTM L07-0     04:00:00       04:00:00   18940             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: CPTM L07-0                               18920             2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: CPTM L07-0                               18919             3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: CPTM L07-0                               18917             4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: CPTM L07-0                               18916             5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: CPTM L07-0                               18965             6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: CPTM L07-0                               18923             7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: CPTM L07-0                               18922             8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: CPTM L07-0                             4114459             9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: CPTM L07-0                               18921            10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: CPTM L07-0                               18924            11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: CPTM L07-0                               18925            12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: CPTM L07-0                               18926            13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: CPTM L07-0                               18971            14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: CPTM L07-0                               18972            15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: CPTM L07-0                               18973            16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: CPTM L07-0                               18974            17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: CPTM L07-0     05:12:51       05:12:51   18975            18</span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Daniel Herszenhut, Rafael H. M. Pereira, Pedro R. Andrade, Joao Bazzo, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer></div>

  


  

  </body></html>

