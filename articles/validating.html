<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Validating GTFS feeds • gtfstools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Validating GTFS feeds">
<meta property="og:description" content="gtfstools">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gtfstools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/gtfstools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/filtering.html">Filtering GTFS feeds</a>
    </li>
    <li>
      <a href="../articles/validating.html">Validating GTFS feeds</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipeaGIT/gtfstools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="validating_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Validating GTFS feeds</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/gtfstools/blob/HEAD/vignettes/validating.Rmd" class="external-link"><code>vignettes/validating.Rmd</code></a></small>
      <div class="hidden name"><code>validating.Rmd</code></div>

    </div>

    
    
<p>Transport planners and researchers very frequently want to assess the quality of the GTFS feeds they have produced and consumed. Are the feeds structured according to the <a href="https://github.com/MobilityData/GTFS_Schedule_Best-Practices" class="external-link">best practices</a> agreed by members of the larger GTFS community? Are tables and fields adequately formatted? Is the information described in the feed reasonable (vehicle speeds, stop locations, etc.)? These are some of the questions that may arise when dealing with GTFS data.</p>
<p>In order to answer these puzzling questions, <strong>gtfstools</strong> includes <code><a href="../reference/validate_gtfs.html">validate_gtfs()</a></code>, a function that wraps the <a href="https://github.com/MobilityData/gtfs-validator" class="external-link">Canonical GTFS Validator</a> developed by MobilityData. The validator requires Java 11 or higher to run - you can check the version you have currently installed with the command <code>java -version</code> on a terminal session or with the command <code>system("java -version")</code> from your R session. If need be, you can download Java 11 from <a href="https://jdk.java.net/java-se-ri/11" class="external-link uri">https://jdk.java.net/java-se-ri/11</a>.</p>
<p>Using <code><a href="../reference/validate_gtfs.html">validate_gtfs()</a></code> is very simple and requires no more than a few function calls. First we need to download the validator command-line tool. We can do it manually from MobilityData releases, or we can use <code><a href="../reference/download_validator.html">download_validator()</a></code>. This function takes a path to a directory where the validator should be saved to and a validator version, which defaults to the latest release, and returns the path to the downloaded validator. Please note that manually downloaded validators should be saved with the same filename convention used by the function (i.e. <code>gtfs-validator-vX.Y.Z.jar</code>). This is important to make sure that our validation function can correctly parse the command-line tool version, which controls some of its behavior.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ipeagit.github.io/gtfstools/" class="external-link">gtfstools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">latest_validator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_validator.html">download_validator</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">latest_validator</span></span>
<span><span class="co">#&gt; [1] "/tmp/Rtmp8oBPVL/gtfs-validator-v4.0.0.jar"</span></span></code></pre></div>
<p>The second (and final) step is actually running <code><a href="../reference/validate_gtfs.html">validate_gtfs()</a></code>. To do that we need some GTFS data, which the function accepts in varying formats: it can be a GTFS object, as created with <code><a href="../reference/read_gtfs.html">read_gtfs()</a></code>, a path to local GTFS file, an URL to a feed or a path to a local directory containing the GTFS data. It also takes a path to the directory where the validator output should be saved to and the path to the validator, previously generated with <code><a href="../reference/download_validator.html">download_validator()</a></code>. Let’s see how it works, using the same GTFS data in three different formats:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/spo_gtfs.zip"</span>, package <span class="op">=</span> <span class="st">"gtfstools"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">path_output_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"validation_from_path"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/validate_gtfs.html">validate_gtfs</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="va">path_output_dir</span>, <span class="va">latest_validator</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">path_output_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "report.html"           "report.json"           "system_errors.json"   </span></span>
<span><span class="co">#&gt; [4] "validation_stderr.txt"</span></span></code></pre></div>
<p>As we can see, the validation generates a few output files:</p>
<ul>
<li>
<code>report.html</code>, shown below, summarizes the validation results in a nicely formatted HTML page (only available when using validator v3.1.0 or higher);</li>
<li>
<code>report.json</code> summarizes the exact same information, but in JSON format, which can be used to easily parse and process the results;</li>
<li>
<code>system_errors.json</code> summarizes eventual system erros that may have happened during the validation and may compromise the results;</li>
<li>
<code>validation_stderr.txt</code> lists the informative messages sent by the command-line tool to the standard error output stream, which includes the list of validators in use, eventual error messages, etc;</li>
<li>had the command-line tool printed anything to the standard output stream, the content would have been saved in <code>validation_stdout.txt</code><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</li>
</ul>
<p><img src="../reference/figures/html_validation_report.png" width="100%"></p>
<p>Had we run the validator using the same GTFS data in different formats (an URL or a GTFS object, for example) the results would be exactly the same:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gtfs_url</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/ipeaGIT/gtfstools/raw/master/inst/extdata/spo_gtfs.zip"</span></span>
<span><span class="va">gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_gtfs.html">read_gtfs</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span></span>
<span></span>
<span><span class="va">url_output_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"validation_from_url"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/validate_gtfs.html">validate_gtfs</a></span><span class="op">(</span><span class="va">gtfs_url</span>, <span class="va">url_output_dir</span>, <span class="va">latest_validator</span><span class="op">)</span></span>
<span></span>
<span><span class="va">object_output_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"validation_from_object"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/validate_gtfs.html">validate_gtfs</a></span><span class="op">(</span><span class="va">gtfs</span>, <span class="va">object_output_dir</span>, <span class="va">latest_validator</span><span class="op">)</span></span>
<span></span>
<span><span class="va">validation_content</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">report_json_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"report.json"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">report_json_content</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">report_json_path</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">report_json_content</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">path_output_content</span> <span class="op">&lt;-</span> <span class="fu">validation_content</span><span class="op">(</span><span class="va">path_output_dir</span><span class="op">)</span></span>
<span><span class="va">url_output_content</span> <span class="op">&lt;-</span> <span class="fu">validation_content</span><span class="op">(</span><span class="va">url_output_dir</span><span class="op">)</span></span>
<span><span class="va">object_output_content</span> <span class="op">&lt;-</span> <span class="fu">validation_content</span><span class="op">(</span><span class="va">object_output_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">path_output_content</span>, <span class="va">url_output_content</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">path_output_content</span>, <span class="va">object_output_content</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Once again, it’s important to acknowledge that <code><a href="../reference/validate_gtfs.html">validate_gtfs()</a></code> only exists thanks to the hard-work of folks at <a href="https://github.com/MobilityData/gtfs-validator" class="external-link">MobilityData/gtfs-validator</a>. A huge shoutout to them!</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Please note that the content of <code>validation_stdout.txt</code> and <code>validation_stderr.txt</code> may slightly vary depending on the version of the validator.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Daniel Herszenhut, Rafael H. M. Pereira, Pedro R. Andrade, Joao Bazzo, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
